<html>
<head> 
	<title>Сеть help. Народный контроллер ТН</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type='text/javascript' src='scripts.js'></script>
	<script type="text/javascript">
		window.onload = function() {
		loadParam("get_tblRelay");
	};
	</script>
</head>
<body class="help">
<div id="menu" class="menu"><script src="menu.js"></script></div>
<div class="content">
<h1>Описание сетевых настроек
	<input style="float:none" type="submit" value="На страницу 'Сеть'" onclick="location.href='lan.html'"></h1>
	<br/>
<!-- Код картинки внутри файла кодировка: http://translit-online.ru/image-base64-converter.html  форматирование строки (длина 1000):https://texttools.ru/add-line-breaks -->

<b>Сетевые настройки</b> - блок параметров отвечающих за сетевые настройки контроллера wiznet w5XXX. Надо понимать что при вводе неверных сетевых настроек может быть потреян доступ к web интрефейсу НК.
При этом управление(очень ограниченное) будет возможно только через дисплей Nextion. На дисплее Nextion на странице сеть можно посмотреть текущие сетевые настройки и пароли для входа.<br/>
При не возможности попасть в web интрефейс, и при физическом доступе к НК можно перевести контроллер в режим safeNetwork в котором будут установлены сетевые настройки по умолчанию
(которые указаны в файле config.h), что позволит попасть в контроллер. Для перевода НК в режим safeNetwork, надо нажать кнопку Кey1 и сбросить контроллер, через 3-5 сек кнопку нужно отпустить.
<br/>
<b>Использовать DHCP сервер</b> - разрешать НК получать адрес от DHCP сервера, При включении этой опции следующие 4 настройки теряют смысл - их НК получает по DHCP.
Надо понимать что при этом не понятен IP адрес НК, и его надо смотреть на DHCP сервере. Этот адрес может меняться через некоторое время (время аренды адрса DHCP сервера)<br/>
<b>IP адрес контроллера</b> - желаемый IP вдрес НК при ручном вводе. Адрес должен быть в диапазоне локальной сети, что бы иметь доступ к нему с других адресов локальной сети.
Именно по этому адресу находится web интрефейс НК.<br/>
<b>Маска подсети</b> - обычно устанавливается 255.255.255.0<br/>
<b>Адрес шлюза</b> - адрес шлюза в инет, обычно это адрес роутера в локальной сети.<br/>
<b>Адрес DNS сервера</b> - адрес через которые перенаправлются DNS запросы, обычно совпадает с адресом шлюза.<br/>
<b>Порт веб-сервера контроллера</b> - порт на который привязан web интрефейс (сервер) НК. Обычно это порт 80. Если НК имеет прямой выход в инет,
то в целях безопастности крайне желательно переопределить на значение в диапазоне 10000-65000 и взятым случайным образом.
Для доступа этот порт указавается в адресной строке браузера через ':' (например 192.168.1.100:13456).<br/>
<b>Аппаратный mac адрес</b> - чип wiznet w5XXX позволяет менять аппаратный mac адрес. При запуске НК крайне желательно сменить его с дефолтного (DE:A1:1E:01:02:03)
т.к. mac адрес должен быть уникален. Надо понимать что НК блокирует отправку данных на 'Народный мониторинг' с дефолтного адреса.<br/>
<br/>
<b>Безопасность</b> - блок параметров отвечающих за сетевую безопастность НК<br/>
<b>Запрет пинга контроллера</b> - при включении данной опции НК не будет отвечать на запросы (ICMP Echo-Request) протокола ICMP. Это позволяет оставаться 'невиденным' при пинговании адреса.<br/>
<b>Использование пароля для входа</b> - включение данной опции позволяет использовать две, заранее определенные роли:<br/>
1. Роль администратора (имя пользователя admin) полный доступ к НК, к полному его функционалу;<br/>
2. Роль пользователя (имя пользователя user) ограниченный доступ к НК, доступны только пять пунктов меню СОСТОЯНИЕ, СХЕМА, ОТОПЛЕНИЕ И ГВС, СТАТИСТИКА, О КОНТРОЛЛЕРЕ.
Это используется для ограничения прав конечного пользователя, что бы он не мог менять настройки которые нужны только для первичной настройки ТН;<br/>
<b>Пароль пользователя </b> - пароль для пользователя user. По умолчанию пароль user, если это поле оставить пустым, то простой веб по умолчанию<br/>
<b>Пароль администратора</b> -  пароль для пользователя admin. По умолчанию пароль admin<br/>
<b>Логировать ошибки веб запросов</b> - при включении этой опции в журнал пишутся все ошибки web запросов. Обычно данная опция выключена.<br/>
<b>Детальный лог</b> - при включении этой опции в журнал пишется полный лог обмена запросами по web. Включение данной опции сильно перегружает журнал, обычно это опция выключена.<br/>
<br/>
<b>Настройки сетевого чипа Wiznet W5xxx</b> - блок параметров отвечающих за 'тонкую' настройку сетевого чипа и повышению надежности работы.<br/>
<b>Проверка ping до сервера, при отсутвии сброс сети</b> - данная опция включает периодический пинг указанного (см. ниже) серевера, при отсутвии пинга НК сбрасывает и инициализирует сетевой чип.
Обычно устанавливают 60 минут.<br/>
<b>Адрес пингуемого сервера </b> - адрес сервера который пингуется для проверке связи. Желательно указывать IP адрес а не имя (что бы не использовать DNS запросы), и указывать адрес шлюза.
Обычно указывается адрес шлюза локальной сети (поле шлюз блока сетевых настроек).<br/>
<b>Ежеминутный контроль связи с Wiznet W5xxx, и при необходимости его сброс</b> - при включении данной опции микроконтроллер периодически читает регистр статуса сетевого чипа Wiznet W5xxx,
при чтении невалидных данных микроконтроллер сбрасывает чип и проводит повторную инициализацию. Обычно эта опция включена.<br/>
<b>Время сброса «зависших» сокетов</b> - в процессе работы бывает обрыв сессий и сокеты оказываются заблокированными. Для их очистки желательно проводить их периодический анализ
на предмет не оконченных сессий для их сброса. Обычно устанавливается 30 секунд.<br/>
<b>Время сброса сетевого чипа Wiznet W5xxx</b> - включение этой опции приводит к периодическому сбросу и переинициализации сетевого чипа. Обычно стоит значение never.
При частых потерях связи с НК рекомендуется включить.<br/>
<b>Размер данных для передачи Wiznet W5xxx (MTU-40 байт)</b> - размер TCP/IP пакета при отсылки данных, обычно надо указывать 1465 байт.<br/>
<b>Не ожидать получения ACK при посылке следующего пакета</b> - при работе на медленных сетях связи (сотовые сети) есть проблема скорости работы по TCP/IP протоколу.
При отправке TCP/IP пакета сетевой чип ждет подтверждения ASK о доставке пакета. Фактически это время равно двойному пингу между узлами, и очень снижает скорость на медленных сетях.
При включении данной опции сетевой чип не будет ожидать получения подтверждения и посылает следующий пакет просто выдержав паузу в передаче(см. следующий пункт).
Доставка пакета не гарантируется, но при правильном подборе времени между посылками позволяет терять минимальное число пакетов.<br/>
Включение данной опции позволяет на медленных сетях поднять скорость в разы.<br/>
<b>Пауза перед отправкой следующего пакета, если нет ожидания ACK</b> - время между посылками отдельных пакетов. Параметр необходимо подобрать опытным путем,
ориентируюсь на потерю пакетов.<br/>
<br/>
<b>Состояние сокетов чипа Wiznet W5xxx.</b> сетевой чип wiznet w5XXX имеет 4 или 8 сокетов. таблица показывает состояние этих сокетов и параметры открытых соединений. <br/>
Статус - код состояния сокета, подробное описание см. в документации на wiznet w5XXX <br/>
MAC адрес - mac адрес устройства которое соединилось с НК<br/>
IP адрес - IP адрес устройства которое соединилось с НК<br/>
Порт - порт соединения с НК, должен быть уникален для одного mac и IP адреса.<br/>
<br/>
В зависимости от числа установленных потоков web сервера в прошивке НК может работать с разным числом сокетов (от 1 до 4) для соединения с одним устройством, по этому
в таблице mac и IP адреса могут повторяться. Таблица обновляется сама, с интервалом в 3-4 секунды, по этому она не отражает полной информации о работе сокетов (сокеты изменяются быстрее).
Последний сокет (3 или 7 в зависимости от чипа) всегда используется как служебный и не используется для соединения с конечным устройством.<br/>
</br>
</br>
</html>